<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>manuelmsni</title>

    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/styles.css">


</head>

<body>

    <script>
        function copyToClipboard(content) {
    var textarea = document.createElement("textarea");
    textarea.style.height = 0;
    document.body.appendChild(textarea);
    textarea.value = content;
    textarea.select();
    document.execCommand("copy");
    document.body.removeChild(textarea);
}
function copia(texto) {
    copyToClipboard(texto);
}
var texto = `
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Connection;
import java.sql.DatabaseMetaData;
import java.sql.SQLSyntaxErrorException;
import java.sql.Statement;
import java.util.ArrayList;
import javax.swing.JOptionPane;

public class MDBConnection {
    
    protected static Connection con;
    
    private static String dbName = "BDExamen";
    private static String dbUser = "root";
    private static String dbPassword = "passwd";
    
    private static String getMDBPrefix(){
        return "jdbc:mariadb:" + "//localhost:3306/";
    }
    
    private static String getDBPath(){
        return getMDBPrefix() + dbName;
    }
    
    public static Connection getConnection() {
        try {
            if (con == null || con.isClosed()) {
                con = DriverManager.getConnection(getDBPath(), dbUser, dbPassword);
            }
            return con;
        } catch (SQLSyntaxErrorException synte) { // La base de datos no esta creada
            info("¡No se puede conectar!", "No existe la base de datos. Se va a intentar crear la base de datos.");
            synte.printStackTrace();
            if (!createDatabase()) System.exit(1);;
        } catch (SQLException ex) {
            ex.printStackTrace();
        }
        
        return null;
    }
    
    private static ArrayList<String> getColumnNames(Connection connection, String tableName){
        ArrayList<String> columnNames = new ArrayList<String>();
        DatabaseMetaData dbmd;
        ResultSet rs = null; 
        try {
            dbmd = connection.getMetaData();
            rs = dbmd.getColumns(null, null, tableName, "%");
            while(rs.next()) { 
                String column = rs.getString("COLUMN_NAME"); 
                columnNames.add(column); 
            } 
        } catch (SQLException ex) {
            error("Error", "No se han podido obtener las columnas de la tabla " + tableName);
            ex.printStackTrace();
        }finally {
            try {
                if (rs != null) {
                    rs.close();
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
        if(!columnNames.isEmpty()) return columnNames;
        return null;
    }
    
    public static ArrayList<String> getTableNames(Connection connection) {
        ArrayList<String> tableNames = new ArrayList<>();
        DatabaseMetaData dbmd;
        ResultSet rs = null;
        try {
            dbmd = connection.getMetaData();
            // Obtener las tablas de la base de datos
            rs = dbmd.getTables(null, null, "%", new String[]{"TABLE"});
            while (rs.next()) {
                String tableName = rs.getString("TABLE_NAME");
                tableNames.add(tableName);
            }
        } catch (SQLException ex) {
            ex.printStackTrace();
        } finally {
            try {
                if (rs != null) {
                    rs.close();
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
        if (!tableNames.isEmpty()) return tableNames;
        return null;
    }
    
    private static boolean createDatabase() {
        try {
            Connection temp = DriverManager.getConnection(getMDBPrefix(), "root", "docker");
            Statement statement = temp.createStatement();
            
            // Crear base de datos
            String createDatabase = "CREATE DATABASE " + dbName;
            statement.executeUpdate(createDatabase);
            String useDatabase = "USE " + dbName;
            statement.executeUpdate(useDatabase);

            // Crear la tabla
            String createEventoTableQuery = "CREATE TABLE IF NOT EXISTS Objeto ("
                    + "UUID VARCHAR(36) PRIMARY KEY, "
                    + "Nombre VARCHAR(50), "
                    + "Fecha DATE)";
            statement.executeUpdate(createEventoTableQuery);
            
            info("¡Operacion exitosa!", "Se ha creado la base de datos.");

            close();
            return true;
        } catch (SQLException e) {
            error("Error fatal","No se ha podido crear la base de datos.");
            e.printStackTrace();
        }
        return false;
    }
    
    public static void close(){
        try {
            if(con != null && !con.isClosed()) con.close();
            else con = null;
        } catch (SQLException ex) {
            ex.printStackTrace();
        }
    }
     
    public static void info(String titulo, String Mensaje){
        JOptionPane.showMessageDialog(null, titulo, Mensaje, JOptionPane.INFORMATION_MESSAGE);
    }
    
    public static void error(String titulo, String Mensaje){
        JOptionPane.showMessageDialog(null, titulo, Mensaje, JOptionPane.ERROR_MESSAGE);
    }
}
import java.util.List;

public interface DAO<T> {
    public List<T> getAll();
    public boolean addObject(T object);
    public boolean updateObject(T object);
    public boolean deleteObject(String id);
}

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.time.LocalDate;
import java.util.ArrayList;

/**
 *
 * @author manuelmsni
 */
public class EventDAO implements DAO<Objeto>{
    
    public EventDAO(){
    }
    
    public boolean addObject(Objeto obj){
        try {
            String insertEventoQuery = "INSERT INTO Objeto (UUID) VALUES (?)";
            PreparedStatement preparedStatement = MDBConnection.getConnection().prepareStatement(insertEventoQuery);
            preparedStatement.setString(1, obj.getId());
            preparedStatement.executeUpdate();
            MDBConnection.close();
            return true;
        } catch (SQLException e) {
            e.printStackTrace();
        }
        MDBConnection.close();
        return false;
    }
    
    public boolean updateObject(Objeto obj) {
        try {
            String updateEventoQuery = "UPDATE Objeto SET Nombre=?, Fecha=? WHERE UUID=?";
            PreparedStatement preparedStatement = MDBConnection.getConnection().prepareStatement(updateEventoQuery);
            preparedStatement.setString(1, obj.getName());
            preparedStatement.setString(2, obj.getDate().toString());
            preparedStatement.setString(3, obj.getId());
            int rowsUpdated = preparedStatement.executeUpdate();
            if (rowsUpdated > 0) {
                System.out.println("Evento actualizado correctamente");
                MDBConnection.close();
                return true;
            } else {
                System.out.println("No se encontró el evento con UUID: " + obj.getId());
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        MDBConnection.close();
        return false;
    }

    public boolean deleteObject(String objId) {
        try {
            String deleteEventoQuery = "DELETE FROM Objeto WHERE UUID=?";
            PreparedStatement preparedStatement = MDBConnection.getConnection().prepareStatement(deleteEventoQuery);
            preparedStatement.setString(1, objId);
            int rowsDeleted = preparedStatement.executeUpdate();
            if (rowsDeleted > 0) {
                MDBConnection.close();
                return true;
            } else {
                System.out.println("No encontrado");
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        MDBConnection.close();
        return false;
    }
    
    public ArrayList<Objeto> getAll(Object parent) {
        ArrayList<Objeto> objetos = new ArrayList<>();
        try {
            Connection con = MDBConnection.getConnection();
            Statement statement = con.createStatement();
            String selectEventosQuery = "SELECT * FROM Objeto";
            ResultSet eventosResult = statement.executeQuery(selectEventosQuery);
            while (eventosResult.next()) {
                Objeto temp = new Objeto(eventosResult.getString("Nombre"), LocalDate.parse(eventosResult.getString("Fecha")));
                objetos.add(temp);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        } finally {
            MDBConnection.close();
        }
        return objetos;
    }
}`;
    </script>

    <section id="Header"></section>

    <div id="outerClickAux" class="no" onclick="outerClick()"></div>

    <section id="Content">
        <div class="margins">
            <!--
            <a href="assets/mainLectura.tmpl">*</a>
            <a href="assets/mainLecturaObj.tmpl">*</a>
            -->
            <div id="DateContainer"></div>
            <hr />
            <div id="ScheduleContainer"></div>

            <br />

            <p copia(texto)> Descargas</p>
            <a href="https://drive.google.com/file/d/1QGDChUdGguR9Gytta8FMfUZZGxvAr_H7/view?usp=sharing">Api Java20</a>
            <a href="https://drive.google.com/file/d/1rRNmsPko5yK90Fs-HmAf0WRR_VpLi7s4/view?usp=sharing">MariaDB portable</a>

            <h1>Módulos</h1>
            <hr />
            <ul>
                <li>
                    <a href="modulos/bases_de_datos/index.html">Bases de datos</a>
                </li>
                <li>
                    <a href="modulos/programacion/index.html">Programación</a>
                </li>
                <li>
                    <a href="modulos/entornos_de_desarrollo/index.html">Entornos de desarrollo</a>
                </li>
                <li>
                    <a href="modulos/markup_languajes/index.html">Lenguaje de marcas</a>
                </li>
                <li>
                    <a href="modulos/sistemas_informaticos/index.html">Sistemas Informáticos</a>
                </li>
            </ul>
        </div>
    </section>

    <section id="Footer">

    </section>
    <a href="https://docs.google.com/document/d/11yWlBmIzaLqLSZQETekHNtwXhMW7KwteCWH9HH6xPCc/edit?usp=sharing">a</a>

    <script src="https://manuelmartinsantamaria.com/assets/vendor/jquery/jquery.min.js"></script>

    <script src="assets/js/main.js"></script>

    <script>

        function callBits() {
            loadHTML('Header', 'assets/bits/header.html');
            loadHTML('Footer', 'assets/bits/footer.html');
            loadHTML('DateContainer', 'assets/bits/clock.html');
            loadHTML('ScheduleContainer', 'assets/bits/horario_dam1.html');
        }

        window.onload = () => {
            callBits();
        };

        /* =================== Reloj =================== */

        $(document).ready(function () {
            setInterval(time, 1000);
        });

        function time() {
            var now = new Date();
            var month = now.getMonth() + 1;
            now.setMonth(month);

            var horas = ("0" + now.getHours()).slice(-2);
            var minutos = ("0" + now.getMinutes()).slice(-2);
            var segundos = ("0" + now.getSeconds()).slice(-2);

            var dia = ("0" + now.getDate()).slice(-2);
            var mes = ("0" + now.getMonth()).slice(-2);
            var amo = ("0" + now.getFullYear()).slice(-4);

            var time = "[ " + dia + "/" + mes + "/" + amo + " ] - [ " + horas + ":" + minutos + ":" + segundos + " ]";
            document.getElementById('Date').innerHTML = time;

            var thistime = new Date();
            var day = thistime.getDay();
            const weekday = ['Domingo', 'Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sábado'];
            document.getElementById('Weekday').innerHTML = weekday[day];
        }

        /* ================== Horario ================== */

        $(document).ready(function () {
            setInterval(horario, 1000);
            setTimeout(tableHeight, 1000);
            setTimeout(tableHeight, 2000);
            setTimeout(tableHeight, 3000);
        });

        window.onresize = function () {
            tableHeight();
        }

        function tableHeight() {
            ancho = $('#ScheduleTable').width();
            altura = (ancho) * (258 / 1406);
            $('#ScheduleTable').css("height", altura + "px");
        }

        function horario() {

            var now = new Date();
            var day = now.getDay();

            if (0 < day && day < 6) {

                $('.active').removeClass('active');
                $('.activeBorder').removeClass('activeBorder');

                var decimalTime = now.getHours() + (now.getMinutes() / 100);
                var tt = 0;
                var td = 0;

                if (day == 1) {
                    $('.a').addClass('active');
                    var dd = "a";
                } if (day == 2) {
                    $('.b').addClass('active');
                    var dd = "b";
                } if (day == 3) {
                    $('.c').addClass('active');
                    var dd = "c";
                } if (day == 4) {
                    $('.d').addClass('active');
                    var dd = "d";
                } if (day == 5) {
                    $('.e').addClass('active');
                    var dd = "e";
                }

                if (16.00 <= decimalTime && decimalTime < 21.45) {

                    if (16.00 <= decimalTime && decimalTime < 16.50) {
                        // Hora 1
                        var tt = 1;
                    } if (16.50 <= decimalTime && decimalTime < 16.55) {
                        // Descanso 1
                        var tb = 1;
                    } if (16.55 <= decimalTime && decimalTime < 17.45) {
                        // Hora 2
                        var tt = 2;
                    } if (17.45 <= decimalTime && decimalTime < 17.50) {
                        // Descanso 2
                        var tb = 2;
                    } if (17.50 <= decimalTime && decimalTime < 18.40) {
                        //Hora 3
                        var tt = 3;
                    } if (18.40 <= decimalTime && decimalTime < 19.05) {
                        // Recreo
                        var tt = 4;
                    } if (19.05 <= decimalTime && decimalTime < 19.55) {
                        //Hora 4
                        var tt = 5;
                    } if (19.55 <= decimalTime && decimalTime < 20.00) {
                        // Descanso 3
                        var tb = 3;
                    } if (20.00 <= decimalTime && decimalTime < 20.50) {
                        //Hora 5
                        var tt = 6;
                    } if (20.50 <= decimalTime && decimalTime < 20.55) {
                        // Descanso 4
                        var tb = 4;
                    } if (20.55 <= decimalTime && decimalTime < 21.45) {
                        //Hora 6
                        var tt = 7;
                    }

                    if (0 < tt) {
                        var code = dd + tt;
                        $('.' + code).addClass('active');
                        $('.t' + tt).addClass('active');
                    } if (0 < tb) {
                        var code = dd + "s" + tb;
                        $('.' + code).addClass('activeBorder');
                        $('.ts' + tb).addClass('activeBorder');
                    }
                }
            }

        };

    </script>

</body>

</html>
